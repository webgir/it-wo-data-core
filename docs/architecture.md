# Архитектура IT-WO Data Core (IWDC)

Этот документ описывает архитектуру IWDC как независимого ядра данных.

## 1. Общая идея

IWDC — это **data-layer**, который:

- принимает табличные данные (XLS/XLSX),
- нормализует их в CSV,
- превращает в строгий JSON-слой,
- проверяет по схемам и бизнес-правилам,
- предоставляет результат для любых клиентов (сайты, API, приложения).

Ключевой принцип: **ни один сайт не является источником правды**.
Источник правды — данные, прошедшие через IWDC.

## 2. Слои системы

1. **Source Layer (`sources/`)**
   - Исходные XLS/XLSX-файлы.
   - Хранятся как вход для ETL.
   - Могут версионироваться (по дате/версии прайса).

2. **Intermediate Layer (`intermediate/csv/`)**
   - Нормализованные CSV-файлы.
   - Вводят единые поля вне зависимости от структуры исходных листов.
   - Примеры: `models.csv`, `lengths.csv`, `seo.csv`, `texts.csv`.

3. **Data Layer (`data/json/`)**
   - Канонический JSON-слой:
     - `series/` — серии продукции.
     - `models/` — модели без длины.
     - `lengths/` — длины моделей.
   - Все клиенты читают именно этот слой.

4. **Logic Layer (`scripts/`, `tools/cli/`)**
   - Скрипты ETL, валидации и diff.
   - CLI-обёртки для удобства запуска.

5. **Contract Layer (`schemas/`, `docs/api-contracts.md`)**
   - JSON Schema для всех сущностей.
   - Контракты API и форматы обмена.

6. **Documentation Layer (`docs/`)**
   - Архитектура, пайплайн, правила, патентное описание.
   - Официальная «память» системы.

7. **Dev/Assistant Layer (`.cursor/`)**
   - Правила и контекст для Cursor.
   - Как ассистент должен работать с IWDC.

## 3. Поток данных (Data Flow)

Упрощённо:

```text
sources/xls
    ↓ (xls-to-csv.mjs)
intermediate/csv
    ↓ (csv-to-json.mjs)
data/json
    ↓ (validate.mjs)
   [валидированный слой]
    ↓ (diff.mjs, changelog.mjs)
отчёты / логи / интеграции
